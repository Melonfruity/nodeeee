{"ast":null,"code":"import _objectSpread from \"/home/hei/Documents/finals/JEK/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/hei/Documents/finals/JEK/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/hei/Documents/finals/JEK/client/src/components/Home.js\";\nimport React, { useEffect, useState } from 'react';\nimport { BrowserRouter as Router, Switch, Route, Link } from 'react-router-dom';\nimport io from 'socket.io-client';\nimport channelService from '../service/channelService';\nimport Channel from './Channel/Channel';\nlet socket;\n\nconst Home = ({\n  logOut\n}) => {\n  const _useState = useState({\n    currentUser: '',\n    selectedChannel: '',\n    username: '',\n    authorization: '',\n    channelStates: {}\n  }),\n        _useState2 = _slicedToArray(_useState, 2),\n        state = _useState2[0],\n        setState = _useState2[1];\n\n  const joinChannelsObj = {\n    authorization: window.localStorage.getItem('authorization'),\n    username: window.localStorage.getItem('username')\n  };\n  console.log(state);\n\n  const deleteMessage = (messageID, channelID) => {\n    socket.emit('delete message', {\n      messageID\n    }, (success, error) => {\n      const edittedMessages = state.channelStates[channelID].messages.filter(msg => msg.id !== messageID);\n      setState(prev => _objectSpread({}, prev, {\n        channelStates: _objectSpread({}, prev.channelStates, {\n          [channelID]: _objectSpread({}, prev.channelStates[channelID], {\n            messages: edittedMessages\n          })\n        })\n      }));\n    });\n  };\n\n  const emitMessage = (message, channelID) => {\n    const messageObj = {\n      message,\n      channelID,\n      authorization: state.authorization,\n      username: state.username\n    };\n    socket.emit('message', messageObj, newMessageObj => {\n      setState(prev => _objectSpread({}, prev, {\n        channelStates: _objectSpread({}, prev.channelStates, {\n          [channelID]: _objectSpread({}, prev.channelStates[channelID], {\n            messages: prev.channelStates[channelID].messages.concat(newMessageObj)\n          })\n        })\n      }));\n    });\n  }; // handle initial state\n\n\n  useEffect(() => {\n    setState(prev => _objectSpread({}, prev, {}, joinChannelsObj)); // grab all channel data, messages\n\n    channelService.getUserData().then(({\n      channelData\n    }) => {\n      const channelStates = channelData.reduce((obj, ele) => {\n        if (!obj[ele.data.channel]) {\n          // eslint-disable-next-line no-param-reassign\n          obj[ele.data.channel] = {\n            users: ele.data.users,\n            name: ele.data.name,\n            messages: ele.messages\n          };\n        }\n\n        return obj;\n      }, {});\n      setState(prev => _objectSpread({}, prev, {\n        channelStates\n      }));\n    });\n  }, []);\n  useEffect(() => {\n    socket = io('http://localhost:8001/');\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', data => {\n        console.log(data);\n      });\n      socket.emit('join channels', joinChannelsObj, data => {\n        console.log(data);\n      });\n    });\n  }, []);\n  useEffect(() => {\n    socket.on('new message', data => {\n      console.log(data); // console.log(state.channelStates[data.channelID]);\n\n      setState(prev => _objectSpread({}, prev, {\n        channelStates: _objectSpread({}, prev.channelStates, {\n          [data.channelID]: _objectSpread({}, prev.channelStates[data.channelID], {\n            messages: prev.channelStates[data.channelID].messages.concat(data.newMessageObj)\n          })\n        })\n      }));\n    });\n    return () => {\n      socket.emit('disconnect');\n      socket.off();\n    };\n  }, [state.channelStates]);\n  const channels = Object.keys(state.channelStates);\n  const channelItems = channels.map(id => {\n    const _state$channelStates$ = state.channelStates[id],\n          users = _state$channelStates$.users,\n          name = _state$channelStates$.name,\n          messages = _state$channelStates$.messages;\n    return React.createElement(Route, {\n      path: `/channel/${id}`,\n      key: `${id}`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, React.createElement(Channel, {\n      channel: id,\n      name: name,\n      messages: messages,\n      users: users,\n      emitMessage: emitMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140\n      },\n      __self: this\n    }));\n  });\n  const channelList = channels.map(id => {\n    const name = state.channelStates[id].name;\n    return React.createElement(\"li\", {\n      key: id,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }, React.createElement(Link, {\n      to: `/channel/${id}`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, name));\n  });\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(Router, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/\",\n    onClick: logOut,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, \" Logout\"), React.createElement(\"nav\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/home\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167\n    },\n    __self: this\n  }, \"Home\")), channelList)), React.createElement(Switch, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172\n    },\n    __self: this\n  }, channelItems)));\n};\n\nexport default Home;","map":{"version":3,"sources":["/home/hei/Documents/finals/JEK/client/src/components/Home.js"],"names":["React","useEffect","useState","BrowserRouter","Router","Switch","Route","Link","io","channelService","Channel","socket","Home","logOut","currentUser","selectedChannel","username","authorization","channelStates","state","setState","joinChannelsObj","window","localStorage","getItem","console","log","deleteMessage","messageID","channelID","emit","success","error","edittedMessages","messages","filter","msg","id","prev","emitMessage","message","messageObj","newMessageObj","concat","getUserData","then","channelData","reduce","obj","ele","data","channel","users","name","on","off","channels","Object","keys","channelItems","map","channelList"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SACEC,aAAa,IAAIC,MADnB,EAEEC,MAFF,EAGEC,KAHF,EAIEC,IAJF,QAKO,kBALP;AAMA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,cAAP,MAA2B,2BAA3B;AAEA,OAAOC,OAAP,MAAoB,mBAApB;AAEA,IAAIC,MAAJ;;AAEA,MAAMC,IAAI,GAAG,CAAC;AAAEC,EAAAA;AAAF,CAAD,KAAgB;AAAA,oBACDX,QAAQ,CAAC;AACjCY,IAAAA,WAAW,EAAE,EADoB;AAEjCC,IAAAA,eAAe,EAAE,EAFgB;AAGjCC,IAAAA,QAAQ,EAAE,EAHuB;AAIjCC,IAAAA,aAAa,EAAE,EAJkB;AAKjCC,IAAAA,aAAa,EAAE;AALkB,GAAD,CADP;AAAA;AAAA,QACpBC,KADoB;AAAA,QACbC,QADa;;AAS3B,QAAMC,eAAe,GAAG;AACtBJ,IAAAA,aAAa,EAAEK,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,eAA5B,CADO;AAEtBR,IAAAA,QAAQ,EAAEM,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,UAA5B;AAFY,GAAxB;AAIAC,EAAAA,OAAO,CAACC,GAAR,CAAYP,KAAZ;;AACA,QAAMQ,aAAa,GAAG,CAACC,SAAD,EAAYC,SAAZ,KAA0B;AAC9ClB,IAAAA,MAAM,CAACmB,IAAP,CAAY,gBAAZ,EAA8B;AAAEF,MAAAA;AAAF,KAA9B,EAA6C,CAACG,OAAD,EAAUC,KAAV,KAAoB;AAE/D,YAAMC,eAAe,GAAGd,KAAK,CAACD,aAAN,CAAoBW,SAApB,EAA+BK,QAA/B,CACrBC,MADqB,CACbC,GAAD,IAASA,GAAG,CAACC,EAAJ,KAAWT,SADN,CAAxB;AAEAR,MAAAA,QAAQ,CAAEkB,IAAD,sBAEFA,IAFE;AAGLpB,QAAAA,aAAa,oBACRoB,IAAI,CAACpB,aADG;AAEX,WAACW,SAAD,qBACKS,IAAI,CAACpB,aAAL,CAAmBW,SAAnB,CADL;AAEEK,YAAAA,QAAQ,EAAED;AAFZ;AAFW;AAHR,QAAD,CAAR;AAWD,KAfD;AAgBD,GAjBD;;AAmBA,QAAMM,WAAW,GAAG,CAACC,OAAD,EAAUX,SAAV,KAAwB;AAC1C,UAAMY,UAAU,GAAG;AACjBD,MAAAA,OADiB;AAEjBX,MAAAA,SAFiB;AAGjBZ,MAAAA,aAAa,EAAEE,KAAK,CAACF,aAHJ;AAIjBD,MAAAA,QAAQ,EAAEG,KAAK,CAACH;AAJC,KAAnB;AAMAL,IAAAA,MAAM,CAACmB,IAAP,CAAY,SAAZ,EAAuBW,UAAvB,EAAoCC,aAAD,IAAmB;AACpDtB,MAAAA,QAAQ,CAAEkB,IAAD,sBAEFA,IAFE;AAGLpB,QAAAA,aAAa,oBACRoB,IAAI,CAACpB,aADG;AAEX,WAACW,SAAD,qBACKS,IAAI,CAACpB,aAAL,CAAmBW,SAAnB,CADL;AAEEK,YAAAA,QAAQ,EAAEI,IAAI,CAACpB,aAAL,CAAmBW,SAAnB,EAA8BK,QAA9B,CAAuCS,MAAvC,CAA8CD,aAA9C;AAFZ;AAFW;AAHR,QAAD,CAAR;AAWD,KAZD;AAaD,GApBD,CAjC2B,CAuD3B;;;AACAzC,EAAAA,SAAS,CAAC,MAAM;AACdmB,IAAAA,QAAQ,CAAEkB,IAAD,sBACJA,IADI,MAEJjB,eAFI,CAAD,CAAR,CADc,CAKd;;AACAZ,IAAAA,cAAc,CACXmC,WADH,GAEGC,IAFH,CAEQ,CAAC;AAAEC,MAAAA;AAAF,KAAD,KAAqB;AACzB,YAAM5B,aAAa,GAAG4B,WAAW,CAACC,MAAZ,CAAmB,CAACC,GAAD,EAAMC,GAAN,KAAc;AACrD,YAAI,CAACD,GAAG,CAACC,GAAG,CAACC,IAAJ,CAASC,OAAV,CAAR,EAA4B;AAC1B;AACAH,UAAAA,GAAG,CAACC,GAAG,CAACC,IAAJ,CAASC,OAAV,CAAH,GAAwB;AACtBC,YAAAA,KAAK,EAAEH,GAAG,CAACC,IAAJ,CAASE,KADM;AAEtBC,YAAAA,IAAI,EAAEJ,GAAG,CAACC,IAAJ,CAASG,IAFO;AAGtBnB,YAAAA,QAAQ,EAAEe,GAAG,CAACf;AAHQ,WAAxB;AAKD;;AACD,eAAOc,GAAP;AACD,OAVqB,EAUnB,EAVmB,CAAtB;AAWA5B,MAAAA,QAAQ,CAAEkB,IAAD,sBAAgBA,IAAhB;AAAsBpB,QAAAA;AAAtB,QAAD,CAAR;AACD,KAfH;AAgBD,GAtBQ,EAsBN,EAtBM,CAAT;AAwBAjB,EAAAA,SAAS,CAAC,MAAM;AACdU,IAAAA,MAAM,GAAGH,EAAE,CAAC,wBAAD,CAAX;AACAG,IAAAA,MAAM,CAAC2C,EAAP,CAAU,SAAV,EAAqB,MAAM;AACzB;AACA3C,MAAAA,MAAM,CAAC2C,EAAP,CAAU,gBAAV,EAA6BJ,IAAD,IAAU;AACpCzB,QAAAA,OAAO,CAACC,GAAR,CAAYwB,IAAZ;AACD,OAFD;AAGAvC,MAAAA,MAAM,CAACmB,IAAP,CAAY,eAAZ,EAA6BT,eAA7B,EAA+C6B,IAAD,IAAU;AACtDzB,QAAAA,OAAO,CAACC,GAAR,CAAYwB,IAAZ;AACD,OAFD;AAGD,KARD;AASD,GAXQ,EAWN,EAXM,CAAT;AAaAjD,EAAAA,SAAS,CAAC,MAAM;AACdU,IAAAA,MAAM,CAAC2C,EAAP,CAAU,aAAV,EAA0BJ,IAAD,IAAU;AACjCzB,MAAAA,OAAO,CAACC,GAAR,CAAYwB,IAAZ,EADiC,CAEjC;;AAEA9B,MAAAA,QAAQ,CAAEkB,IAAD,sBAEFA,IAFE;AAGLpB,QAAAA,aAAa,oBACRoB,IAAI,CAACpB,aADG;AAEX,WAACgC,IAAI,CAACrB,SAAN,qBACKS,IAAI,CAACpB,aAAL,CAAmBgC,IAAI,CAACrB,SAAxB,CADL;AAEEK,YAAAA,QAAQ,EAAEI,IAAI,CAACpB,aAAL,CAAmBgC,IAAI,CAACrB,SAAxB,EAAmCK,QAAnC,CAA4CS,MAA5C,CAAmDO,IAAI,CAACR,aAAxD;AAFZ;AAFW;AAHR,QAAD,CAAR;AAWD,KAfD;AAgBA,WAAO,MAAM;AACX/B,MAAAA,MAAM,CAACmB,IAAP,CAAY,YAAZ;AACAnB,MAAAA,MAAM,CAAC4C,GAAP;AACD,KAHD;AAID,GArBQ,EAqBN,CAACpC,KAAK,CAACD,aAAP,CArBM,CAAT;AAuBA,QAAMsC,QAAQ,GAAGC,MAAM,CAACC,IAAP,CAAYvC,KAAK,CAACD,aAAlB,CAAjB;AAEA,QAAMyC,YAAY,GAAGH,QAAQ,CAACI,GAAT,CAAcvB,EAAD,IAAQ;AAAA,kCACNlB,KAAK,CAACD,aAAN,CAAoBmB,EAApB,CADM;AAAA,UAChCe,KADgC,yBAChCA,KADgC;AAAA,UACzBC,IADyB,yBACzBA,IADyB;AAAA,UACnBnB,QADmB,yBACnBA,QADmB;AAExC,WACE,oBAAC,KAAD;AACE,MAAA,IAAI,EAAG,YAAWG,EAAG,EADvB;AAEE,MAAA,GAAG,EAAG,GAAEA,EAAG,EAFb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAIE,oBAAC,OAAD;AACE,MAAA,OAAO,EAAEA,EADX;AAEE,MAAA,IAAI,EAAEgB,IAFR;AAGE,MAAA,QAAQ,EAAEnB,QAHZ;AAIE,MAAA,KAAK,EAAEkB,KAJT;AAKE,MAAA,WAAW,EAAEb,WALf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJF,CADF;AAcD,GAhBoB,CAArB;AAkBA,QAAMsB,WAAW,GAAGL,QAAQ,CAACI,GAAT,CAAcvB,EAAD,IAAQ;AAAA,UAC/BgB,IAD+B,GACtBlC,KAAK,CAACD,aAAN,CAAoBmB,EAApB,CADsB,CAC/BgB,IAD+B;AAEvC,WACE;AAAI,MAAA,GAAG,EAAEhB,EAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,IAAD;AAAM,MAAA,EAAE,EAAG,YAAWA,EAAG,EAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA6BgB,IAA7B,CADF,CADF;AAKD,GAPmB,CAApB;AASA,SACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,IAAD;AAAM,IAAA,EAAE,EAAC,GAAT;AAAa,IAAA,OAAO,EAAExC,MAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF,EAEE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,IAAD;AAAM,IAAA,EAAE,EAAC,OAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADF,CADF,EAIGgD,WAJH,CADF,CAFF,EAUE,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGF,YADH,CAVF,CADF,CADF;AAkBD,CAnKD;;AAqKA,eAAe/C,IAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from 'react-router-dom';\nimport io from 'socket.io-client';\nimport channelService from '../service/channelService';\n\nimport Channel from './Channel/Channel';\n\nlet socket;\n\nconst Home = ({ logOut }) => {\n  const [state, setState] = useState({\n    currentUser: '',\n    selectedChannel: '',\n    username: '',\n    authorization: '',\n    channelStates: {},\n  });\n\n  const joinChannelsObj = {\n    authorization: window.localStorage.getItem('authorization'),\n    username: window.localStorage.getItem('username'),\n  };\n  console.log(state);\n  const deleteMessage = (messageID, channelID) => {\n    socket.emit('delete message', { messageID }, (success, error) => {\n\n      const edittedMessages = state.channelStates[channelID].messages\n        .filter((msg) => msg.id !== messageID);\n      setState((prev) => (\n        {\n          ...prev,\n          channelStates: {\n            ...prev.channelStates,\n            [channelID]: {\n              ...prev.channelStates[channelID],\n              messages: edittedMessages,\n            },\n          },\n        }));\n    });\n  };\n\n  const emitMessage = (message, channelID) => {\n    const messageObj = {\n      message,\n      channelID,\n      authorization: state.authorization,\n      username: state.username,\n    };\n    socket.emit('message', messageObj, (newMessageObj) => {\n      setState((prev) => (\n        {\n          ...prev,\n          channelStates: {\n            ...prev.channelStates,\n            [channelID]: {\n              ...prev.channelStates[channelID],\n              messages: prev.channelStates[channelID].messages.concat(newMessageObj),\n            },\n          },\n        }));\n    });\n  };\n\n  // handle initial state\n  useEffect(() => {\n    setState((prev) => ({\n      ...prev,\n      ...joinChannelsObj,\n    }));\n    // grab all channel data, messages\n    channelService\n      .getUserData()\n      .then(({ channelData }) => {\n        const channelStates = channelData.reduce((obj, ele) => {\n          if (!obj[ele.data.channel]) {\n            // eslint-disable-next-line no-param-reassign\n            obj[ele.data.channel] = {\n              users: ele.data.users,\n              name: ele.data.name,\n              messages: ele.messages,\n            };\n          }\n          return obj;\n        }, {});\n        setState((prev) => ({ ...prev, channelStates }));\n      });\n  }, []);\n\n  useEffect(() => {\n    socket = io('http://localhost:8001/');\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', (data) => {\n        console.log(data);\n      });\n      socket.emit('join channels', joinChannelsObj, (data) => {\n        console.log(data);\n      });\n    });\n  }, []);\n\n  useEffect(() => {\n    socket.on('new message', (data) => {\n      console.log(data);\n      // console.log(state.channelStates[data.channelID]);\n\n      setState((prev) => (\n        {\n          ...prev,\n          channelStates: {\n            ...prev.channelStates,\n            [data.channelID]: {\n              ...prev.channelStates[data.channelID],\n              messages: prev.channelStates[data.channelID].messages.concat(data.newMessageObj),\n            },\n          },\n        }));\n    });\n    return () => {\n      socket.emit('disconnect');\n      socket.off();\n    };\n  }, [state.channelStates]);\n\n  const channels = Object.keys(state.channelStates);\n\n  const channelItems = channels.map((id) => {\n    const { users, name, messages } = state.channelStates[id];\n    return (\n      <Route\n        path={`/channel/${id}`}\n        key={`${id}`}\n      >\n        <Channel\n          channel={id}\n          name={name}\n          messages={messages}\n          users={users}\n          emitMessage={emitMessage}\n        />\n      </Route>\n    );\n  });\n\n  const channelList = channels.map((id) => {\n    const { name } = state.channelStates[id];\n    return (\n      <li key={id}>\n        <Link to={`/channel/${id}`}>{name}</Link>\n      </li>\n    );\n  });\n\n  return (\n    <div>\n      <Router>\n        <Link to=\"/\" onClick={logOut}> Logout</Link>\n        <nav>\n          <ul>\n            <li>\n              <Link to=\"/home\">Home</Link>\n            </li>\n            {channelList}\n          </ul>\n        </nav>\n        <Switch>\n          {channelItems}\n        </Switch>\n      </Router>\n    </div>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}