{"ast":null,"code":"import _objectSpread from \"/home/hei/Documents/finals/JEK/client/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/home/hei/Documents/finals/JEK/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/hei/Documents/finals/JEK/client/src/components/Home.js\";\nimport React, { useEffect, useState } from 'react';\nimport { BrowserRouter as Router, Switch, Route, Link } from 'react-router-dom';\nimport io from 'socket.io-client';\nimport channelService from '../service/channelService';\nimport Channel from './Channel/Channel';\nimport ChannelList from './Channel/LeftBar/ChannelList/ChannelList';\nlet socket;\n\nconst Home = ({\n  logOut,\n  userExists\n}) => {\n  const _useState = useState(_objectSpread({\n    currentUser: '',\n    currentChannel: '',\n    channelStates: {}\n  }, userExists)),\n        _useState2 = _slicedToArray(_useState, 2),\n        state = _useState2[0],\n        setState = _useState2[1];\n\n  console.log(window.localStorage.getItem('guest'));\n  console.log(window.localStorage.getItem('authorization'));\n  console.log(state);\n\n  const emitDeleteMessage = messageID => {};\n\n  const emitEditMessage = messageID => {};\n\n  const emitSendMessage = message => {\n    const channelID = state.currentChannel;\n    const messageObj = {\n      message,\n      channelID,\n      authorization: state.authorization,\n      username: state.username\n    };\n    socket.emit('message', messageObj, newMessageObj => {\n      setState(prev => _objectSpread({}, prev, {\n        channelStates: _objectSpread({}, prev.channelStates, {\n          [channelID]: _objectSpread({}, prev.channelStates[channelID], {\n            messages: prev.channelStates[channelID].messages.concat(newMessageObj)\n          })\n        })\n      }));\n    });\n  };\n\n  const emitJoinChannel = channelLink => {\n    const joinChannelObj = {\n      channelLink,\n      authorization: state.authorization\n    };\n    socket.emit('join channel', joinChannelObj, channelData => {\n      const error = channelData.error,\n            data = channelData.data,\n            messages = channelData.messages;\n\n      if (!error) {\n        const channel = data.channel;\n        setState(prev => _objectSpread({}, prev, {\n          channelStates: _objectSpread({}, prev.channelStates, {\n            [channel]: _objectSpread({}, data, {\n              messages\n            })\n          })\n        }));\n      } else {\n        console.log(error);\n      }\n    });\n  };\n\n  const emitCreateChannel = channelName => {\n    const createChannelObj = {\n      channelName,\n      authorization: state.authorization\n    };\n    socket.emit('create channel', createChannelObj, channelData => {\n      const data = channelData.data,\n            messages = channelData.messages;\n      const channel = data.channel;\n      setState(prev => _objectSpread({}, prev, {\n        channelStates: _objectSpread({}, prev.channelStates, {\n          [channel]: _objectSpread({}, data, {\n            messages\n          })\n        })\n      }));\n    });\n  }; // handle initial state\n\n\n  useEffect(() => {\n    // grab all channel data, messages\n    if (state.authorization) {\n      channelService.getUserData().then(({\n        channelData\n      }) => {\n        const channelStates = channelData.reduce((obj, ele) => {\n          if (!obj[ele.data.channel]) {\n            // eslint-disable-next-line no-param-reassign\n            obj[ele.data.channel] = {\n              users: ele.data.users,\n              name: ele.data.name,\n              channel: ele.data.channel,\n              messages: ele.messages\n            };\n          }\n\n          return obj;\n        }, {});\n        setState(prev => _objectSpread({}, prev, {\n          channelStates\n        }));\n      });\n    }\n  }, [state.authorization]);\n  useEffect(() => {\n    socket = io('http://localhost:8001/');\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', data => {\n        console.log(data);\n      });\n      socket.emit('join channels', {\n        authorization: state.authorization\n      }, data => {\n        console.log(data);\n      });\n    });\n  }, [state.authorization]);\n  useEffect(() => {\n    socket.on('new message', data => {\n      const channelID = data.channelID,\n            newMessageObj = data.newMessageObj;\n      setState(prev => _objectSpread({}, prev, {\n        channelStates: _objectSpread({}, prev.channelStates, {\n          [channelID]: _objectSpread({}, prev.channelStates[channelID], {\n            messages: prev.channelStates[channelID].messages.concat(newMessageObj)\n          })\n        })\n      }));\n    });\n    socket.on('new user', data => {});\n    return () => {\n      socket.emit('disconnect');\n      socket.off();\n    };\n  }, []);\n  useEffect(() => {\n    setState(prev => _objectSpread({}, prev, {\n      username: window.localStorage.getItem('username'),\n      authorization: window.localStorage.getItem('authorization'),\n      guest: window.localStorage.getItem('guest')\n    }));\n  }, []);\n  const channels = Object.keys(state.channelStates);\n  const channelIdNamePair = channels.map(id => ({\n    id,\n    name: state.channelStates[id].name\n  }));\n\n  const selectCurrentChannel = channel => {\n    setState(prev => _objectSpread({}, prev, {\n      currentChannel: channel\n    }));\n  };\n\n  const channelItems = channels.map(id => {\n    const _state$channelStates$ = state.channelStates[id],\n          users = _state$channelStates$.users,\n          name = _state$channelStates$.name,\n          messages = _state$channelStates$.messages;\n    return React.createElement(Route, {\n      path: `/channel/${id}`,\n      key: `${id}`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, React.createElement(Channel, {\n      channel: id,\n      name: name,\n      messages: messages,\n      users: users,\n      emitSendMessage: emitSendMessage,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }));\n  });\n  console.log(state);\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203\n    },\n    __self: this\n  }, React.createElement(Router, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }, React.createElement(Link, {\n    to: \"/\",\n    onClick: logOut,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205\n    },\n    __self: this\n  }, \" Logout\"), React.createElement(\"nav\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206\n    },\n    __self: this\n  }, React.createElement(\"ul\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207\n    },\n    __self: this\n  }, React.createElement(ChannelList, {\n    selectCurrentChannel: selectCurrentChannel,\n    channelIdNamePair: channelIdNamePair,\n    emitJoinChannel: emitJoinChannel,\n    emitCreateChannel: emitCreateChannel,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208\n    },\n    __self: this\n  }))), React.createElement(Switch, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }, channelItems)));\n};\n\nexport default Home;","map":{"version":3,"sources":["/home/hei/Documents/finals/JEK/client/src/components/Home.js"],"names":["React","useEffect","useState","BrowserRouter","Router","Switch","Route","Link","io","channelService","Channel","ChannelList","socket","Home","logOut","userExists","currentUser","currentChannel","channelStates","state","setState","console","log","window","localStorage","getItem","emitDeleteMessage","messageID","emitEditMessage","emitSendMessage","message","channelID","messageObj","authorization","username","emit","newMessageObj","prev","messages","concat","emitJoinChannel","channelLink","joinChannelObj","channelData","error","data","channel","emitCreateChannel","channelName","createChannelObj","getUserData","then","reduce","obj","ele","users","name","on","off","guest","channels","Object","keys","channelIdNamePair","map","id","selectCurrentChannel","channelItems"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Link,\n} from 'react-router-dom';\nimport io from 'socket.io-client';\nimport channelService from '../service/channelService';\n\nimport Channel from './Channel/Channel';\nimport ChannelList from './Channel/LeftBar/ChannelList/ChannelList';\n\nlet socket;\n\nconst Home = ({ logOut, userExists }) => {\n  const [state, setState] = useState({\n    currentUser: '',\n    currentChannel: '',\n    channelStates: {},\n    ...userExists,\n  });\n\n  console.log(window.localStorage.getItem('guest'))\n  console.log(window.localStorage.getItem('authorization'));\n\n  console.log(state);\n  const emitDeleteMessage = (messageID) => {\n  };\n\n  const emitEditMessage = (messageID) => {\n  };\n\n  const emitSendMessage = (message) => {\n    const channelID = state.currentChannel;\n    const messageObj = {\n      message,\n      channelID,\n      authorization: state.authorization,\n      username: state.username,\n    };\n    socket.emit('message', messageObj, (newMessageObj) => {\n      setState((prev) => (\n        {\n          ...prev,\n          channelStates: {\n            ...prev.channelStates,\n            [channelID]: {\n              ...prev.channelStates[channelID],\n              messages: prev.channelStates[channelID].messages.concat(newMessageObj),\n            },\n          },\n        }));\n    });\n  };\n\n  const emitJoinChannel = (channelLink) => {\n    const joinChannelObj = {\n      channelLink,\n      authorization: state.authorization,\n    };\n    socket.emit('join channel', joinChannelObj, (channelData) => {\n      const { error, data, messages } = channelData;\n      if (!error) {\n        const { channel } = data;\n        setState((prev) => (\n          {\n            ...prev,\n            channelStates: {\n              ...prev.channelStates,\n              [channel]: {\n                ...data,\n                messages,\n              },\n            },\n          }\n        ));\n      } else {\n        console.log(error);\n      }\n    });\n  };\n\n  const emitCreateChannel = (channelName) => {\n    const createChannelObj = {\n      channelName,\n      authorization: state.authorization,\n    };\n    socket.emit('create channel', createChannelObj, (channelData) => {\n      const { data, messages } = channelData;\n      const { channel } = data;\n      setState((prev) => (\n        {\n          ...prev,\n          channelStates: {\n            ...prev.channelStates,\n            [channel]: {\n              ...data,\n              messages,\n            },\n          },\n        }\n      ));\n    });\n  };\n\n  // handle initial state\n  useEffect(() => {\n    // grab all channel data, messages\n    if (state.authorization) {\n      channelService\n        .getUserData()\n        .then(({ channelData }) => {\n          const channelStates = channelData.reduce((obj, ele) => {\n            if (!obj[ele.data.channel]) {\n              // eslint-disable-next-line no-param-reassign\n              obj[ele.data.channel] = {\n                users: ele.data.users,\n                name: ele.data.name,\n                channel: ele.data.channel,\n                messages: ele.messages,\n              };\n            }\n            return obj;\n          }, {});\n          setState((prev) => ({ ...prev, channelStates }));\n        });\n    }\n  }, [state.authorization]);\n\n  useEffect(() => {\n    socket = io('http://localhost:8001/');\n    socket.on('connect', () => {\n      // from servers\n      socket.on('server message', (data) => {\n        console.log(data);\n      });\n      socket.emit('join channels', { authorization: state.authorization }, (data) => {\n        console.log(data);\n      });\n    });\n  }, [state.authorization]);\n\n  useEffect(() => {\n    socket.on('new message', (data) => {\n      const { channelID, newMessageObj } = data;\n      setState((prev) => (\n        {\n          ...prev,\n          channelStates: {\n            ...prev.channelStates,\n            [channelID]: {\n              ...prev.channelStates[channelID],\n              messages: prev.channelStates[channelID].messages.concat(newMessageObj),\n            },\n          },\n        }));\n    });\n    socket.on('new user', (data) => {\n\n    });\n    return () => {\n      socket.emit('disconnect');\n      socket.off();\n    };\n  }, []);\n\n  useEffect(() => {\n    setState((prev) => ({\n      ...prev,\n      username: window.localStorage.getItem('username'),\n      authorization: window.localStorage.getItem('authorization'),\n      guest: window.localStorage.getItem('guest'),\n    }));\n  }, []);\n\n  const channels = Object.keys(state.channelStates);\n  const channelIdNamePair = channels.map((id) => ({ id, name: state.channelStates[id].name }));\n\n  const selectCurrentChannel = (channel) => {\n    setState((prev) => ({ ...prev, currentChannel: channel }));\n  };\n\n  const channelItems = channels.map((id) => {\n    const { users, name, messages } = state.channelStates[id];\n    return (\n      <Route\n        path={`/channel/${id}`}\n        key={`${id}`}\n      >\n        <Channel\n          channel={id}\n          name={name}\n          messages={messages}\n          users={users}\n          emitSendMessage={emitSendMessage}\n        />\n      </Route>\n    );\n  });\n  console.log(state);\n  return (\n    <div>\n      <Router>\n        <Link to=\"/\" onClick={logOut}> Logout</Link>\n        <nav>\n          <ul>\n            <ChannelList\n              selectCurrentChannel={selectCurrentChannel}\n              channelIdNamePair={channelIdNamePair}\n              emitJoinChannel={emitJoinChannel}\n              emitCreateChannel={emitCreateChannel}\n            />\n          </ul>\n        </nav>\n        <Switch>\n          {channelItems}\n        </Switch>\n      </Router>\n    </div>\n  );\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}